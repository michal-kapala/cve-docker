FROM node:current-alpine3.17 as installer

ARG TARGETOS
ARG TARGETARCH
ARG TARGETVARIANT
ARG VERSION

ENV BUILDX_ARCH="${TARGETOS:-linux}_${TARGETARCH:-amd64}${TARGETVARIANT}"

COPY ./t3_linux /t3

RUN apk update && apk add ca-certificates && rm -rf /var/cache/apk/*

FROM node:current-alpine3.17

EXPOSE 3000

COPY --from=installer /t3 /t3

# installs node modules
RUN cd t3 && npm install

ENTRYPOINT cd t3 && npm run start
